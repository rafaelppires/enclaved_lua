<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>Lua CJSON 2.1devel Manual</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Lua CJSON 2.1devel Manual</h1>
<span id="author">Mark Pulford</span><br />
<span id="email"><code>&lt;<a href="mailto:mark@kyne.com.au">mark@kyne.com.au</a>&gt;</code></span><br />
<span id="revdate">August 2016</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Lua CJSON module provides JSON support for Lua.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>Features</strong>
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Fast, standards compliant encoding/parsing routines
</p>
</li>
<li>
<p>
Full support for JSON with UTF-8, including decoding surrogate pairs
</p>
</li>
<li>
<p>
Optional run-time support for common exceptions to the JSON
  specification (infinity, NaN,..)
</p>
</li>
<li>
<p>
No dependencies on other libraries
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
<strong>Caveats</strong>
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
UTF-16 and UTF-32 are not supported
</p>
</li>
</ul></div>
</dd>
</dl></div>
<div class="paragraph"><p>Lua CJSON is covered by the MIT license. Review the file <code>LICENSE</code> for
details.</p></div>
<div class="paragraph"><p>The current stable version of this software is available from the
<a href="http://www.kyne.com.au/%7Emark/software/lua-cjson.php">Lua CJSON website</a>.</p></div>
<div class="paragraph"><p>Feel free to email me if you have any patches, suggestions, or comments.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">2. Installation</h2>
<div class="sectionbody">
<div class="paragraph"><p>Lua CJSON requires either <a href="http://www.lua.org">Lua</a> 5.1, Lua 5.2, Lua 5.3,
or <a href="http://www.luajit.org">LuaJIT</a> to build.</p></div>
<div class="paragraph"><p>The build method can be selected from 4 options:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Make
</dt>
<dd>
<p>
Unix (including Linux, BSD, Mac OSX &amp; Solaris), Windows
</p>
</dd>
<dt class="hdlist1">
CMake
</dt>
<dd>
<p>
Unix, Windows
</p>
</dd>
<dt class="hdlist1">
RPM
</dt>
<dd>
<p>
Linux
</p>
</dd>
<dt class="hdlist1">
LuaRocks
</dt>
<dd>
<p>
Unix, Windows
</p>
</dd>
</dl></div>
<div class="sect2">
<h3 id="_make">2.1. Make</h3>
<div class="paragraph"><p>The included <code>Makefile</code> has generic settings.</p></div>
<div class="paragraph"><p>First, review and update the included makefile to suit your platform (if
required).</p></div>
<div class="paragraph"><p>Next, build and install the module:</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Or install manually into your Lua module directory:</p></div>
<div class="listingblock">
<div class="content"></div></div>
</div>
<div class="sect2">
<h3 id="_cmake">2.2. CMake</h3>
<div class="paragraph"><p><a href="http://www.cmake.org">CMake</a> can generate build configuration for many
different platforms (including Unix and Windows).</p></div>
<div class="paragraph"><p>First, generate the makefile for your platform using CMake. If CMake is
unable to find Lua, manually set the <code>LUA_DIR</code> environment variable to
the base prefix of your Lua 5.1 installation.</p></div>
<div class="paragraph"><p>While <code>cmake</code> is used in the example below, <code>ccmake</code> or <code>cmake-gui</code> may
be used to present an interface for changing the default build options.</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Next, build and install the module:</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Review the
<a href="http://www.cmake.org/cmake/help/documentation.html">CMake documentation</a>
for further details.</p></div>
</div>
<div class="sect2">
<h3 id="_rpm">2.3. RPM</h3>
<div class="paragraph"><p>Linux distributions using <a href="http://rpm.org">RPM</a> can create a package via
the included RPM spec file. Ensure the <code>rpm-build</code> package (or similar)
has been installed.</p></div>
<div class="paragraph"><p>Build and install the module via RPM:</p></div>
<div class="listingblock">
<div class="content"></div></div>
</div>
<div class="sect2">
<h3 id="_luarocks">2.4. LuaRocks</h3>
<div class="paragraph"><p><a href="http://luarocks.org">LuaRocks</a> can be used to install and manage Lua
modules on a wide range of platforms (including Windows).</p></div>
<div class="paragraph"><p>First, extract the Lua CJSON source package.</p></div>
<div class="paragraph"><p>Next, install the module:</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">LuaRocks does not support platform specific configuration for Solaris.
On Solaris, you may need to manually uncomment <code>USE_INTERNAL_ISINF</code> in
the rockspec before building this module.</td>
</tr></table>
</div>
<div class="paragraph"><p>Review the <a href="http://luarocks.org/en/Documentation">LuaRocks documentation</a>
for further details.</p></div>
</div>
<div class="sect2">
<h3 id="build_options">2.5. Build Options (#define)</h3>
<div class="paragraph"><p>Lua CJSON offers several <code>#define</code> build options to address portability
issues, and enable non-default features. Some build methods may
automatically set platform specific options if required. Other features
should be enabled manually.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
USE_INTERNAL_ISINF
</dt>
<dd>
<p>
Workaround for Solaris platforms missing <code>isinf</code>.
</p>
</dd>
<dt class="hdlist1">
DISABLE_INVALID_NUMBERS
</dt>
<dd>
<p>
Recommended on platforms where <code>strtod</code> /
  <code>sprintf</code> are not POSIX compliant (eg, Windows MinGW). Prevents
  <code>cjson.encode_invalid_numbers</code> and <code>cjson.decode_invalid_numbers</code> from
  being enabled. However, <code>cjson.encode_invalid_numbers</code> may still be
  set to <code>"null"</code>. When using the Lua CJSON built-in floating point
  conversion this option is unnecessary and is ignored.
</p>
</dd>
</dl></div>
<div class="sect3">
<h4 id="_built_in_floating_point_conversion">2.5.1. Built-in floating point conversion</h4>
<div class="paragraph"><p>Lua CJSON may be built with David Gay&#8217;s
<a href="http://www.netlib.org/fp/">floating point conversion routines</a>. This can
increase overall performance by up to 50% on some platforms when
converting a large amount of numeric data. However, this option reduces
portability and is disabled by default.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
USE_INTERNAL_FPCONV
</dt>
<dd>
<p>
Enable internal number conversion routines.
</p>
</dd>
<dt class="hdlist1">
IEEE_BIG_ENDIAN
</dt>
<dd>
<p>
Must be set on big endian architectures.
</p>
</dd>
<dt class="hdlist1">
MULTIPLE_THREADS
</dt>
<dd>
<p>
Must be set if Lua CJSON may be used in a
  multi-threaded application. Requires the <em>pthreads</em> library.
</p>
</dd>
</dl></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api_functions">3. API (Functions)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_synopsis">3.1. Synopsis</h3>
<div class="listingblock">
<div class="content"></div></div>
</div>
<div class="sect2">
<h3 id="_module_instantiation">3.2. Module Instantiation</h3>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Import Lua CJSON via the Lua <code>require</code> function. Lua CJSON does not
register a global module table.</p></div>
<div class="paragraph"><p>The <code>cjson</code> module will throw an error during JSON conversion if any
invalid data is encountered. Refer to <a href="#encode"><code>cjson.encode</code></a> and
<a href="#decode"><code>cjson.decode</code></a> for details.</p></div>
<div class="paragraph"><p>The <code>cjson.safe</code> module behaves identically to the <code>cjson</code> module,
except when errors are encountered during JSON conversion. On error, the
<code>cjson_safe.encode</code> and <code>cjson_safe.decode</code> functions will return
<code>nil</code> followed by the error message.</p></div>
<div class="paragraph"><p><code>cjson.new</code> can be used to instantiate an independent copy of the Lua
CJSON module. The new module has a separate persistent encoding buffer,
and default settings.</p></div>
<div class="paragraph"><p>Lua CJSON can support Lua implementations using multiple preemptive
threads within a single Lua state provided the persistent encoding
buffer is not shared. This can be achieved by one of the following
methods:</p></div>
<div class="ulist"><ul>
<li>
<p>
Disabling the persistent encoding buffer with
  <a href="#encode_keep_buffer"><code>cjson.encode_keep_buffer</code></a>
</p>
</li>
<li>
<p>
Ensuring each thread calls <a href="#encode"><code>cjson.encode</code></a> separately (ie,
  treat <code>cjson.encode</code> as non-reentrant).
</p>
</li>
<li>
<p>
Using a separate <code>cjson</code> module table per preemptive thread
  (<code>cjson.new</code>)
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Lua CJSON uses <code>strtod</code> and <code>snprintf</code> to perform numeric conversion as
they are usually well supported, fast and bug free. However, these
functions require a workaround for JSON encoding/parsing under locales
using a comma decimal separator. Lua CJSON detects the current locale
during instantiation to determine and automatically implement the
workaround if required. Lua CJSON should be reinitialised via
<code>cjson.new</code> if the locale of the current process changes. Using a
different locale per thread is not supported.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="decode">3.3. decode</h3>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p><code>cjson.decode</code> will deserialise any UTF-8 JSON string into a Lua value
or table.</p></div>
<div class="paragraph"><p>UTF-16 and UTF-32 JSON strings are not supported.</p></div>
<div class="paragraph"><p><code>cjson.decode</code> requires that any NULL (ASCII 0) and double quote (ASCII
34) characters are escaped within strings. All escape codes will be
decoded and other bytes will be passed transparently. UTF-8 characters
are not validated during decoding and should be checked elsewhere if
required.</p></div>
<div class="paragraph"><p>JSON <code>null</code> will be converted to a NULL <code>lightuserdata</code> value. This can
be compared with <code>cjson.null</code> for convenience.</p></div>
<div class="paragraph"><p>By default, numbers incompatible with the JSON specification (infinity,
NaN, hexadecimal) can be decoded. This default can be changed with
<a href="#decode_invalid_numbers"><code>cjson.decode_invalid_numbers</code></a>.</p></div>
<div class="listingblock">
<div class="title">Example: Decoding</div>
<div class="content"></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Care must be taken after decoding JSON objects with numeric keys. Each
numeric key will be stored as a Lua <code>string</code>. Any subsequent code
assuming type <code>number</code> may break.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="decode_invalid_numbers">3.4. decode_invalid_numbers</h3>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Lua CJSON may generate an error when trying to decode numbers not
supported by the JSON specification. <em>Invalid numbers</em> are defined as:</p></div>
<div class="ulist"><ul>
<li>
<p>
infinity
</p>
</li>
<li>
<p>
NaN
</p>
</li>
<li>
<p>
hexadecimal
</p>
</li>
</ul></div>
<div class="paragraph"><p>Available settings:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>true</code>
</dt>
<dd>
<p>
Accept and decode <em>invalid numbers</em>. This is the default
  setting.
</p>
</dd>
<dt class="hdlist1">
<code>false</code>
</dt>
<dd>
<p>
Throw an error when <em>invalid numbers</em> are encountered.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The current setting is always returned, and is only updated when an
argument is provided.</p></div>
</div>
<div class="sect2">
<h3 id="decode_max_depth">3.5. decode_max_depth</h3>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Lua CJSON will generate an error when parsing deeply nested JSON once
the maximum array/object depth has been exceeded. This check prevents
unnecessarily complicated JSON from slowing down the application, or
crashing the application due to lack of process stack space.</p></div>
<div class="paragraph"><p>An error may be generated before the depth limit is hit if Lua is unable
to allocate more objects on the Lua stack.</p></div>
<div class="paragraph"><p>By default, Lua CJSON will reject JSON with arrays and/or objects nested
more than 1000 levels deep.</p></div>
<div class="paragraph"><p>The current setting is always returned, and is only updated when an
argument is provided.</p></div>
</div>
<div class="sect2">
<h3 id="encode">3.6. encode</h3>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p><code>cjson.encode</code> will serialise a Lua value into a string containing the
JSON representation.</p></div>
<div class="paragraph"><p><code>cjson.encode</code> supports the following types:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>boolean</code>
</p>
</li>
<li>
<p>
<code>lightuserdata</code> (NULL value only)
</p>
</li>
<li>
<p>
<code>nil</code>
</p>
</li>
<li>
<p>
<code>number</code>
</p>
</li>
<li>
<p>
<code>string</code>
</p>
</li>
<li>
<p>
<code>table</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>The remaining Lua types will generate an error:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>function</code>
</p>
</li>
<li>
<p>
<code>lightuserdata</code> (non-NULL values)
</p>
</li>
<li>
<p>
<code>thread</code>
</p>
</li>
<li>
<p>
<code>userdata</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>By default, numbers are encoded with 14 significant digits. Refer to
<a href="#encode_number_precision"><code>cjson.encode_number_precision</code></a> for details.</p></div>
<div class="paragraph"><p>Lua CJSON will escape the following characters within each UTF-8 string:</p></div>
<div class="ulist"><ul>
<li>
<p>
Control characters (ASCII 0 - 31)
</p>
</li>
<li>
<p>
Double quote (ASCII 34)
</p>
</li>
<li>
<p>
Forward slash (ASCII 47)
</p>
</li>
<li>
<p>
Blackslash (ASCII 92)
</p>
</li>
<li>
<p>
Delete (ASCII 127)
</p>
</li>
</ul></div>
<div class="paragraph"><p>All other bytes are passed transparently.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph"><p>Lua CJSON will successfully encode/decode binary strings, but this is
technically not supported by JSON and may not be compatible with other
JSON libraries. To ensure the output is valid JSON, applications should
ensure all Lua strings passed to <code>cjson.encode</code> are UTF-8.</p></div>
<div class="paragraph"><p>Base64 is commonly used to encode binary data as the most efficient
encoding under UTF-8 can only reduce the encoded size by a further
&#126;8%. Lua Base64 routines can be found in the
<a href="http://w3.impa.br/%7Ediego/software/luasocket/">LuaSocket</a> and
<a href="http://www.tecgraf.puc-rio.br/%7Elhf/ftp/lua/#lbase64">lbase64</a> packages.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Lua CJSON uses a heuristic to determine whether to encode a Lua table as
a JSON array or an object. A Lua table with only positive integer keys
of type <code>number</code> will be encoded as a JSON array. All other tables will
be encoded as a JSON object.</p></div>
<div class="paragraph"><p>Lua CJSON does not use metamethods when serialising tables.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>rawget</code> is used to iterate over Lua arrays
</p>
</li>
<li>
<p>
<code>next</code> is used to iterate over Lua objects
</p>
</li>
</ul></div>
<div class="paragraph"><p>Lua arrays with missing entries (<em>sparse arrays</em>) may optionally be
encoded in several different ways. Refer to
<a href="#encode_sparse_array"><code>cjson.encode_sparse_array</code></a> for details.</p></div>
<div class="paragraph"><p>JSON object keys are always strings. Hence <code>cjson.encode</code> only supports
table keys which are type <code>number</code> or <code>string</code>. All other types will
generate an error.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Standards compliant JSON must be encapsulated in either an object (<code>{}</code>)
or an array (<code>[]</code>). If strictly standards compliant JSON is desired, a
table must be passed to <code>cjson.encode</code>.</td>
</tr></table>
</div>
<div class="paragraph"><p>By default, encoding the following Lua values will generate errors:</p></div>
<div class="ulist"><ul>
<li>
<p>
Numbers incompatible with the JSON specification (infinity, NaN)
</p>
</li>
<li>
<p>
Tables nested more than 1000 levels deep
</p>
</li>
<li>
<p>
Excessively sparse Lua arrays
</p>
</li>
</ul></div>
<div class="paragraph"><p>These defaults can be changed with:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="#encode_invalid_numbers"><code>cjson.encode_invalid_numbers</code></a>
</p>
</li>
<li>
<p>
<a href="#encode_max_depth"><code>cjson.encode_max_depth</code></a>
</p>
</li>
<li>
<p>
<a href="#encode_sparse_array"><code>cjson.encode_sparse_array</code></a>
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Example: Encoding</div>
<div class="content"></div></div>
</div>
<div class="sect2">
<h3 id="encode_invalid_numbers">3.7. encode_invalid_numbers</h3>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Lua CJSON may generate an error when encoding floating point numbers not
supported by the JSON specification (<em>invalid numbers</em>):</p></div>
<div class="ulist"><ul>
<li>
<p>
infinity
</p>
</li>
<li>
<p>
NaN
</p>
</li>
</ul></div>
<div class="paragraph"><p>Available settings:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>true</code>
</dt>
<dd>
<p>
Allow <em>invalid numbers</em> to be encoded using the Javascript
  compatible values <code>NaN</code> and <code>Infinity</code>. This will generate
  non-standard JSON, but these values are supported by some libraries.
</p>
</dd>
<dt class="hdlist1">
<code>"null"</code>
</dt>
<dd>
<p>
Encode <em>invalid numbers</em> as a JSON <code>null</code> value. This allows
  infinity and NaN to be encoded into valid JSON.
</p>
</dd>
<dt class="hdlist1">
<code>false</code>
</dt>
<dd>
<p>
Throw an error when attempting to encode <em>invalid numbers</em>.
  This is the default setting.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The current setting is always returned, and is only updated when an
argument is provided.</p></div>
</div>
<div class="sect2">
<h3 id="encode_keep_buffer">3.8. encode_keep_buffer</h3>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Lua CJSON can reuse the JSON encoding buffer to improve performance.</p></div>
<div class="paragraph"><p>Available settings:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>true</code>
</dt>
<dd>
<p>
The buffer will grow to the largest size required and is not
  freed until the Lua CJSON module is garbage collected. This is the
  default setting.
</p>
</dd>
<dt class="hdlist1">
<code>false</code>
</dt>
<dd>
<p>
Free the encode buffer after each call to <code>cjson.encode</code>.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The current setting is always returned, and is only updated when an
argument is provided.</p></div>
</div>
<div class="sect2">
<h3 id="encode_max_depth">3.9. encode_max_depth</h3>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Once the maximum table depth has been exceeded Lua CJSON will generate
an error. This prevents a deeply nested or recursive data structure from
crashing the application.</p></div>
<div class="paragraph"><p>By default, Lua CJSON will generate an error when trying to encode data
structures with more than 1000 nested tables.</p></div>
<div class="paragraph"><p>The current setting is always returned, and is only updated when an
argument is provided.</p></div>
<div class="listingblock">
<div class="title">Example: Recursive Lua table</div>
<div class="content"></div></div>
</div>
<div class="sect2">
<h3 id="encode_number_precision">3.10. encode_number_precision</h3>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>The amount of significant digits returned by Lua CJSON when encoding
numbers can be changed to balance accuracy versus performance. For data
structures containing many numbers, setting
<code>cjson.encode_number_precision</code> to a smaller integer, for example <code>3</code>,
can improve encoding performance by up to 50%.</p></div>
<div class="paragraph"><p>By default, Lua CJSON will output 14 significant digits when converting
a number to text.</p></div>
<div class="paragraph"><p>The current setting is always returned, and is only updated when an
argument is provided.</p></div>
</div>
<div class="sect2">
<h3 id="encode_sparse_array">3.11. encode_sparse_array</h3>
<div class="listingblock">
<div class="content"></div></div>
<div class="paragraph"><p>Lua CJSON classifies a Lua table into one of three kinds when encoding a
JSON array. This is determined by the number of values missing from the
Lua array as follows:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Normal
</dt>
<dd>
<p>
All values are available.
</p>
</dd>
<dt class="hdlist1">
Sparse
</dt>
<dd>
<p>
At least 1 value is missing.
</p>
</dd>
<dt class="hdlist1">
Excessively sparse
</dt>
<dd>
<p>
The number of values missing exceeds the configured
  ratio.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Lua CJSON encodes sparse Lua arrays as JSON arrays using JSON <code>null</code> for
the missing entries.</p></div>
<div class="paragraph"><p>An array is excessively sparse when all the following conditions are
met:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>ratio</code> &gt; <code>0</code>
</p>
</li>
<li>
<p>
<em>maximum_index</em> &gt; <code>safe</code>
</p>
</li>
<li>
<p>
<em>maximum_index</em> &gt; <em>item_count</em> * <code>ratio</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Lua CJSON will never consider an array to be <em>excessively sparse</em> when
<code>ratio</code> = <code>0</code>. The <code>safe</code> limit ensures that small Lua arrays are always
encoded as sparse arrays.</p></div>
<div class="paragraph"><p>By default, attempting to encode an <em>excessively sparse</em> array will
generate an error. If <code>convert</code> is set to <code>true</code>, <em>excessively sparse</em>
arrays will be converted to a JSON object.</p></div>
<div class="paragraph"><p>The current settings are always returned. A particular setting is only
changed when the argument is provided (non-<code>nil</code>).</p></div>
<div class="listingblock">
<div class="title">Example: Encoding a sparse array</div>
<div class="content"></div></div>
<div class="listingblock">
<div class="title">Example: Enabling conversion to a JSON object</div>
<div class="content"></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api_variables">4. API (Variables)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_name">4.1. _NAME</h3>
<div class="paragraph"><p>The name of the Lua CJSON module (<code>"cjson"</code>).</p></div>
</div>
<div class="sect2">
<h3 id="_version">4.2. _VERSION</h3>
<div class="paragraph"><p>The version number of the Lua CJSON module (<code>"2.1devel"</code>).</p></div>
</div>
<div class="sect2">
<h3 id="_null">4.3. null</h3>
<div class="paragraph"><p>Lua CJSON decodes JSON <code>null</code> as a Lua <code>lightuserdata</code> NULL pointer.
<code>cjson.null</code> is provided for comparison.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">5. References</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<a href="http://tools.ietf.org/html/rfc4627">RFC 4627</a>
</p>
</li>
<li>
<p>
<a href="http://www.json.org/">JSON website</a>
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2017-01-25 20:30:31 CET
</div>
</div>
</body>
</html>
